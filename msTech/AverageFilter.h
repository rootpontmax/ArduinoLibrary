////////////////////////////////////////////////////////////////////////////////////////////////////
// Simple average filter.                                                                         //
////////////////////////////////////////////////////////////////////////////////////////////////////
#ifndef MS_TECH_AVERAGE_FILTER_H
#define MS_TECH_AVERAGE_FILTER_H

////////////////////////////////////////////////////////////////////////////////////////////////////
template <typename T, int N, T zero>
class CAverageFilter
{
public:
	CAverageFilter();
	void    Add( T value );
    T    	Calc();

private:
	T       m_ringBuffer[N];
    int     m_ringPos;
    int		m_count;
};
////////////////////////////////////////////////////////////////////////////////////////////////////
template<typename T, int N, T zero>
CAverageFilter< T, N, zero >::CAverageFilter() :
    m_ringPos( 0 ),
    m_count( 0 )
{}
////////////////////////////////////////////////////////////////////////////////////////////////////
template<typename T, int N, T zero>
void CAverageFilter< T, N, zero >::Add( T value )
{
    m_ringBuffer[m_ringPos] = value;
    ++m_ringPos;
    m_ringPos %= N;
    if( m_count < N )
    	++m_count;
}
////////////////////////////////////////////////////////////////////////////////////////////////////
template<typename T, int N, T zero>
T CAverageFilter< T, N, zero >::Calc()
{
	if( 0 == m_count )
		return zero;

	T sum = zero;
	for( int i = 0; i < m_count; ++i )
	{
		sum += m_ringBuffer[i];
	}

	sum /= m_count;
	return sum;
}
////////////////////////////////////////////////////////////////////////////////////////////////////
#endif